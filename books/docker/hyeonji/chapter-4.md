# 도커 네트워크

### 도커네트워크

도커 컨테이너 및 서비스는 도커 네트워크를 통해 격리된 컨테이너 간의 네트워크 연결뿐만 아니라 도커 외의 다른 애플리케이션 워크로드와도 연결이 가능.

도커 네트워크 하위 시스템 연결을 위해 도커 네트워크 드라이버를 사용하여 상호 간 통신이 가능해짐.

### 도커 레퍼런스의 도커 네트워크 정의

도커 설치 시 기본적으로 제공되는 docker0는 소프트웨어적으로 구현된 가상 이더넷 브리지 네트워크이고, 이것을 통해 격리된 컨테이너들의 상호 간 통신을 제공.

→ 별도의 브리지 네트워크를 생성하여 연결값으로 설정하지 않는 한 실행되는 모든 컨테이너는 docker0 브리지에 연결되어 172.17.0.0/16의 CIDER(클래스없는 도메인 간 라우팅 기법) 범위로 IP주소가 할당.

/16은 최대 65,536개의 IP주소 범위를 가짐.

### 도커 브리지 네트워크 연결

- enp0s8: Ubuntu 리눅스의 네트워크 카드.
- docker0: 도커 설치 시 기본적으로 제공되는 브리지 네트워크로 172.17.0.1 주소를 가짐. docker0브리지는 소프트웨어적인 스위치 방식으로 동작하며, 일반적인 스위치 방식과는 다르게 DHCP로 연결된 컨테이너에 사전에 정의된 IP풀을 할당.
- vethxxxxxxxx: OSI 7 계층 서비스 모델의 2계층 서비스로 컨테이너 내부에 제공되는 네트워크 인터페이스 eth0와 한 쌍으로 제공되어 docker0와 가상의 터널링 네트워크를 제공.
- ehe0: 도커 컨테이너에 생성되는 기본 네트워크 인터페이스명으로 docker0를 게이트웨이로 사용. 순차적으로 IP 주소를 할당받거나 사용자가 동일 대역의 IP 주소를 지정할 수 있음.

### 도커 네트워크 드라이버

도커 네트워크 하위 시스템 연결에 사용되는 도커 네트워크 드라이버는 도커 엔진의 일부이며 추가 구성할 필요가 없음. 

docker —net, —network 옵션을 이용해 선택할 수 있고 docker network 명령을 통해 호출하여 사용

- Bridge : 기본 네트워크 드라이버로 컨테이너 실행 시 별도의 네트워크 지정 없이 독립적으로 실행되는 애플리케이션 컨테이너를 실행하는 경우 사용. 브리지 모드는 동일 호스트 상의 도커 컨테이너에만 적용됨.
- host : 컨테이너 host 모드를 사용하면 컨테이너와 호스트 간의 네트워크 격리를 제거하고 호스트의 네트워킹을 직접 사용할 수 있음. 이 기능을 통해 컨테이너 애플리케이션에 별도의 포트 연결 없이 호스트의 포트를 이용하여 바로 서비스 할 수 있음.
- overlay : 다중 호스트 도커 서버를 이용한 클러스터(도커 스웜) 등을 이용할 경우 도커 데몬 간의 연결을 통해 컨테이너 서비스를 수행할 수 있음. 해당 옵션은 컨테이너 간에 운영체제 수준의 라우팅을 사용하지 않아도 되며, 도커 클러스터인 도커 스웜 구축 시 호스트와 호스트 간의 컨테이너 연결에 사용됨.
- macvlan : 물리적 네트워크에 컨테이너 mac 주소를 통한 직접 연결 구현 시 사용.
- none : 컨테이너 네트워크를 사용하지 않도록 설정. none 네트워크로 설정하면 네트워크 인터페이스는 Io 인터페이스(루프백 어댑터)만 존재.
- 컨테이너 네트워크 : container: 공유받을 컨테이너 이름 옵션은 컨테이너 네트워크 네임 스페이스 스택(IP 주소, mac 주소 등)을 공유하여 같이 사용.
- 사용자 정의 네트워크 : docker network create 명령을 통해 사용자가 직접 생선한 도커 네트워크로 아무런 옵션을 주지 않고 생성하면 docker0 IP 대역의 다른 CIDR을 지정하여 생성.

→ **오버레이를 통해 서로다른 서버의 도커간의 연결이 가능함.**

😀 참고문서
https://code-machina.github.io/2019/08/08/Docker-Swarm-Overlay-Network-Part-1.html

도커 네트워크 카드의 경우 **docker connect**로 추가 연결이 가능하고 **docker disconnect**를 사용하면 해제됨.

### 도커 사용자 정의 네트워크 활용

🌟 —net-alias와 도커 DNS 서비스를 활용한 부하 분산

- 사용자 정의 브리지 네트워크와 docker run 수행 시 —net-alias 또는 —link 옵션으로 묶인 모든 컨테이너에는 기본적으로 서비스를 검색할 수 있는 내장 DNS 서버가 제공. 
→**자동화 DNS 확인**
- 내장 DNS 서버는 특정 사용자 정의 네트워크에서 모든 컨테이너 별칭과 해당 IP주소간의 매핑을 유지
- 이러한 DNS 서버는 포함된 컨테이너의 IP가 변경되거나 신규 컨테이너가 포함되면 자동 감지를 통해 해당 IP를 등록하고 반환

---

# 😞도커 너무 어렵습니다!!!
