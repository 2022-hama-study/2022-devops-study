# docker-chapter3

### 도커를 왜 사용하는지?

개발, 테스트, 배포, 운영의 컴퓨팅 환경 차이로 발생되는 오류 해결에 너무 많은 시간이 소요.
따라서 어플리케이션 개발환경이 도커 기반의 컨테이너 서비스 환경으로 전환
잉 호스트 운영체제를 공유하고 애플리케이션에 필요한 환경을 패키징하는 것을 운영체제 레벨 가상화.

### 운영체제 레벨 가상화 2가지

운영체제 레벨 가상화에는 2가지 존재하며 다음과 같음

1. 하드웨어 레벨 가상화: 하이퍼바이저 등을 이용한 가상머신 방식
2. 운영체제 레벨 가상화: 컨테이너 기반의 애플리케이션 서비스 방식

### 도커기반 애플리케이션 개발의 라이프사이클

1. 애플리케이션 코드 개발
2. 베이스 이미지를 이용한 Dockerfile 작성
3. Dockfile bulid를 통한 새로운 이미지 생성
   4-1. 생성된 이미지를 이용한 컨테이너 실행 -> 5-1. 컨테이너 어플리케이션 서비스 테스트
   4-2. 도커 컴포즈를 이용한 다중 컨테이너 실행 -> 마이크로서비스 테스트
4. 로컬 및 원격 저장소에 이미지 저장
5. 깃허브 등을 활용한 Dockerfile관리
6. 동일 환경에서의 지속적 어플리케이션 개발 수행

해당 과정을 동작하는 모든 내용을 사전에 코드로 작성하여 앤서블, 셰프, 베이그런트와 같은 인프라 프로비저닝 도구로 자동화 하게되면 필요할 때마다 적은 비용으로 빠르게 개발, 배포, 확장 가능
이러한 개념을 IaC(infrastructure as code, 코드로서의 인프라스트럭처)라고 함.

### 도커 명령어

다운로드한 이미지 정보 조회 → **docker image ls**

이미지 정보 조회시 다이제스트 라는 값이 존재하는데 이 값은 원격 도커 레지스트리(도커 허브)에서 관리하는 이미지의 고유 식별값. 해당값을 포함한 조회는 → **docker image --digests**

도커 이미지 구성을 위해 사용된 레이블 정보와 각 레이어의 수행 명령, 크키 등을 조회하기 위한 명령어 →docker image history [options]image

docker run의 명령어의 경우 해당 도커 이미지 복사본 스냅숏 레이어 위에 읽고 쓰기가 가능한 컨테이너 레이어를 추가한 뒤 docker start 명령으로 실행까지 할 수 있는 간편한 명령어!
또한 호스트 서버에 다운받고자 하는 이미지가 로컬에 없을 경우 이미지를 도커 허브에서 자동으로 다운로드한다는 점과 마지막에 해당 컨테이너에 실행할 명령을 입력하면 컨테이너 동작과 함께 처리.

docker run 옵션 중 v라는 옵션 존재. 해당 옵션은 호스트 경로와 컨테이너 경로의 공유 볼륨 설정으로 로컬 폴더와 공유할 수 있음
docker cp 옵션을 통해 로컬에 있는 파일을 복사해서 넣을수있어 간단히 도커내부의 파일을 편집할 경우 cp를 활용하여 굳이 vi 편집기와 같은 설치를 할 필요가 없음


### 도커 볼륨

도커는 유니언 파일 시스템을 이용하여 하나의 이미지로 부터 여러 컨테이너 생성 가능. 

또한 호스트 운영 체제에서 직접 접근이 가능.

💡 **질문! 만약 도커 볼륨을 사용한 컨테이너가 삭제될 경우 볼륨도 함께 삭제 될까요?**

# 도커 볼륨 타입

### **volumn**

- 도커에서 권장하는 방법으로 docker volume create 볼륨 이름을 통해 볼륨을 생성.
- 도커 볼륨은 도커 명령어를 통해 관리
- 여러 컨테이너 간에 안전하게 공유
- 볼륨드라이버를 통해 원격 호스트 및 클라우드 환경에 볼륨 내용을 저장하고 암호화
- 새 볼륨으로 지정될 영역에 데이터를 미리 채우고 컨테이너에 연결하면 컨테이너 내에서 바로 데이터 사용이 가능

### bind mount

- 도커볼륨 기법에 비해 사용이 제한적.
- 호스트 파일 시스템 절대경로: 컨테이너 내부 경로를 직접 마운트하여 사용
- 사용자가 파일 또는 디렉터리를 생성하면 해당 호스트 파일 시스템의 소유자 권한으로 연결이 되고 존재하지 않는 경우 자동 생성. 이때 자동생성된 디렉터리는 루트 사용자 소유
- 컨테이너 실행 시 지정하여 사용하고 컨테이너 제거 시 바인드 마운트는 해제되지만 호스트 디렉터리는 유지

### tmpfs mount

- 컨테이너가 중지된 후에도 데이터를 유지 할 수 있지만 tmpfs 마운트 방법은 임시적이며 호스트 메모리에서만 지속되므로 컨테이너가 중지되면 tmpfs 마운트가 제거되고 내부에 기록된 파일은 유지 되지 않음
- 컨테이너 실행 시 지정하여 사용하고 컨테이너 제거 시 자동해제

### 도커 이미지

도커 이미지는 여러개의 도커 컨테이너를 실행할 수있으며 처음 내려받은 이미지는 수백 메가 용량을 가지고 있지만 컨테이너를 구동 할 때마다 이미지를 내려받지 않고 로컬에 저장된 이미지를 계속 사용.
이미지 레이어의 상단에 있는 웹 어플리케이션 소스 레이어의 환경 설정 및 리소스 설정이 변경되어 이미지로 변경되더라도 기존 레이어를 제외한 변경되더라도 기존 레이어를 제외한 변경된 웹소스 레이어만 받아서 사용하기 때문에 효율적.
